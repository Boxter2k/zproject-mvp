// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TagCategory {
  DISCIPLINA
  ESTILO
  TEMA
}

model User {
  id          String         @id @default(cuid())
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  email       String         @unique
  displayName String
  avatarUrl   String?
  posts       Post[]
  likes       UserLikes[]
  dislikes    UserDislikes[]
}

model Post {
  id          String    @id @default(cuid())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  authorId    String
  author      User      @relation(fields: [authorId], references: [id])
  title       String
  description String?
  imageUrl    String?
  videoUrl    String?
  tags        PostTag[]
  likesCount  Int       @default(0)
}

model Tag {
  id         String         @id @default(cuid())
  name       String         @unique
  category   TagCategory
  posts      PostTag[]
  likedBy    UserLikes[]
  dislikedBy UserDislikes[]
}

model PostTag {
  postId String
  tagId  String
  post   Post   @relation(fields: [postId], references: [id])
  tag    Tag    @relation(fields: [tagId], references: [id])

  @@id([postId, tagId])
}

model UserLikes {
  userId String
  tagId  String
  user   User   @relation(fields: [userId], references: [id])
  tag    Tag    @relation(fields: [tagId], references: [id])

  @@id([userId, tagId])
}

model UserDislikes {
  userId String
  tagId  String
  user   User   @relation(fields: [userId], references: [id])
  tag    Tag    @relation(fields: [tagId], references: [id])

  @@id([userId, tagId])
}
